{{define "body"}}
<section class="upload">
  <form
    action="/upload"
    method="POST"
    enctype="multipart/form-data"
    id="uploadForm"
  >
    <table>
      <tr class="form-group">
        <td><label for="subject">Subject</label></td>
        <td><input type="text" id="subject" name="subject" /></td>
      </tr>
      <tr class="form-group">
        <td><label for="message">Message</label></td>
        <td>
          <textarea
            id="message"
            name="message"
            rows="4"
            maxlength="50"
          ></textarea>
        </td>
      </tr>
      <tr class="form-group">
        <td><label for="imageFile">Select File</label></td>
        <td>
          <div class="file-input-wrapper">
            <input
              type="file"
              id="imageFile"
              name="imageFile"
              accept="image/png,image/jpeg"
              required
            />
          </div>
        </td>
      </tr>
      <tr>
        <td></td>
        <td>
          <button type="submit">Post</button>
        </td>
      </tr>
    </table>
  </form>
</section>

<section class="gallery">
  {{range .}}
  <article class="gallery__item">
    {{if .Image}}
    <div class="post-image">
      <div class="file-info">
        <a href="/img/{{.Image.ID}}">{{.Image.ShortID}}.{{.Image.Extension}}</a>
        - {{.Image.FormattedSize}} {{.Image.Width}}x{{.Image.Height}}
      </div>
      <a href="/img/{{.Image.ID}}">
        <img
          src="/img/{{.Image.ID}}_600"
          srcset="
            /img/{{.Image.ID}}_600   600w,
            /img/{{.Image.ID}}_800   800w,
            /img/{{.Image.ID}}_1200 1200w,
            /img/{{.Image.ID}}_1600 1600w
          "
          sizes="(max-width: 480px) 90vw, (max-width: 768px) 45vw, 300px"
          loading="lazy"
          alt="Image {{.Image.ID}}"
        />
      </a>
    </div>
    {{end}}
    <div class="post-content">
      <div class="post-header">
        <span class="post-name"
          >{{if .Post.Name}}{{.Post.Name}}{{else}}Anonymous{{end}}</span
        >&nbsp;
        <span class="post-date"
          >{{if
          .Image}}{{.Image.FormattedTime}}{{else}}{{.Post.FormattedTime}}{{end}}</span
        >
      </div>
      {{if .Post.Subject}}
      <div class="post-subject">{{.Post.Subject}}</div>
      {{end}} {{if .Post.Message}}
      <details>
        <summary>Life Story</summary>
        <div>Nothing special, I think you're pretty cool.</div>
      </details>
      <div class="post-message">{{.Post.Message}}</div>
      {{end}}
    </div>
  </article>
  {{else}}
  <p>No images available.</p>
  {{end}}
</section>

<style>
  .upload {
    max-width: 500px;
    margin: 0 auto 2rem;
  }

  .form-group input[type="text"],
  .form-group textarea {
    width: 100%;
    padding: 0.5rem;
    font-size: 1rem;
  }

  .form-group textarea {
    resize: vertical;
  }

  .file-input-wrapper input[type="file"] {
    width: 100%;
    padding: 0.5rem;
    font-size: 1rem;
  }

  .upload button {
    width: 100%;
    padding: 0.5rem;
    font-size: 1rem;
  }

  .gallery__item {
    display: flex;
    gap: 1rem;
    margin-bottom: 1.5rem;
    padding-bottom: 1.5rem;
    border-bottom: 1px solid #4a4a5a;
  }

  .gallery__item:last-child {
    border-bottom: none;
  }

  .post-image {
    flex-shrink: 0;
  }

  .post-image img {
    float: left;
    max-width: 200px;
    height: auto;
    display: block;
  }

  .file-info {
    font-size: 0.8rem;
    color: #808090;
    margin-top: 0.25rem;
  }

  .post-content {
    flex: 1;
    min-width: 0;
  }

  .post-header {
    margin-bottom: 0.25rem;
  }

  .post-name {
    font-weight: bold;
    color: #88a0d0;
  }

  .post-date {
    color: #707080;
    font-size: 0.875rem;
    margin-left: 0.5rem;
  }

  .post-subject {
    font-weight: 600;
    margin-bottom: 0.5rem;
  }

  .post-message {
    color: #d0d0e0;
    white-space: pre-wrap;
    word-wrap: break-word;
  }
</style>

<script>
  window.addEventListener("pageshow", function () {
    document.getElementById("uploadForm").reset();
  });
</script>
{{end}}
