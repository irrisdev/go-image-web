{{define "body"}}
<section class="upload">
  <form action="/upload" method="POST" enctype="multipart/form-data" id="uploadForm" autocomplete="off">
    <table>
      <tr class="form-group">
        <td><label for="subject">Subject</label></td>
        <td><input type="text" id="subject" name="subject" autocomplete="off" maxlength="100" /></td>
      </tr>
      <tr class="form-group">
        <td><label for="message">Message</label></td>
        <td>
          <textarea id="message" name="message" rows="4" maxlength="1500" autocomplete="off"></textarea>
        </td>
      </tr>
      <tr class="form-group">
        <td><label for="imageFile">Select File</label></td>
        <td>
          <div class="file-input-wrapper">
            <input type="file" id="imageFile" name="imageFile" accept="image/png,image/jpeg,image/webp" autocomplete="off" required />
          </div>
        </td>
      </tr>
      <tr>
        <td></td>
        <td>
          <button type="submit">Post</button>
        </td>
      </tr>
    </table>
  </form>
</section>
<section class="gallery">
  {{range .}}
  <article class="gallery__item">
    <div class="post-content">
      {{if .Image}}
      <div class="post-image">
        <div class="file-info"><a href="/img/{{.Image.ID}}">{{.Image.ShortID}}.{{.Image.Extension}}</a> <span>- {{.Image.FormattedSize}} {{.Image.Width}}x{{.Image.Height}}</span></div>
        <a href="/img/{{.Image.ID}}" class="file-image">
          <img
            src="/img/{{.Image.ID}}_600"
            srcset="/img/{{.Image.ID}}_600 600w, /img/{{.Image.ID}}_800 800w, /img/{{.Image.ID}}_1200 1200w, /img/{{.Image.ID}}_1600 1600w"
            sizes="(max-width: 480px) 90vw, (max-width: 768px) 45vw, 300px"
            loading="lazy"
            alt="Image {{.Image.ID}}" />
        </a>
      </div>
      {{end}}

      <div class="post-header">
        {{if .Post.Subject}}
        <span class="post-subject">{{.Post.Subject}}</span>&nbsp;&nbsp; {{end}} <span class="post-name">{{if .Post.Name}}{{.Post.Name}}{{else}}Anonymous{{end}}</span>&nbsp;
        <span class="post-date">{{if .Image}}{{.Image.FormattedTime}}{{else}}{{.Post.FormattedTime}}{{end}}</span>
      </div>

      {{if .Post.Message}} {{if .Post.NeedsExpand}}
      <input type="checkbox" id="expand-{{.Post.ID}}" class="message-toggle" />
      <div class="post-message post-message--preview">{{.Post.TruncatedMessage}}...</div>
      <div class="post-message post-message--full">{{.Post.Message}}</div>
      <label for="expand-{{.Post.ID}}" class="view-more">View all</label>
      {{else}}
      <div class="post-message">{{.Post.Message}}</div>
      {{end}} {{end}}
    </div>
  </article>
  {{else}}
  <p>No images available.</p>
  {{end}}
</section>

<style>
  .message-toggle {
    display: none;
  }

  .post-message {
    color: #d0d0e0;
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  /* Preview message (truncated) - shown by default */
  .post-message--preview {
    display: block;
  }

  /* Full message - hidden by default */
  .post-message--full {
    display: none;
  }

  /* When expanded: hide preview, show full */
  .message-toggle:checked ~ .post-message--preview {
    display: none;
  }

  .message-toggle:checked ~ .post-message--full {
    display: block;
  }

  .view-more {
    display: block;
    color: #88a0d0;
    cursor: pointer;
    font-size: 0.875rem;
    user-select: none;
    margin-top: 0.25rem;
  }

  .view-more::before {
    content: "â–¸ ";
  }

  .view-more:hover {
    color: #a0b8e0;
    text-decoration: underline;
  }

  /* Hide "View more" when expanded */
  .message-toggle:checked ~ .view-more {
    display: none;
  }

  .upload {
    max-width: 500px;
    margin: 0 auto 2rem;
  }

  .form-group input[type="text"],
  .form-group textarea {
    width: 100%;
    padding: 0.5rem;
    font-size: 1rem;
  }

  .form-group textarea {
    resize: vertical;
  }

  .file-input-wrapper input[type="file"] {
    width: 100%;
    padding: 0.5rem;
    font-size: 1rem;
  }

  .upload button {
    width: 100%;
    padding: 0.5rem;
    font-size: 1rem;
  }

  .gallery__item {
    margin-bottom: 1.5rem;
    padding-bottom: 1.5rem;
    border-bottom: 1px solid #4a4a5a;
  }

  .gallery__item:last-child {
    border-bottom: none;
  }

  .post-content {
    overflow: hidden;
  }

  .post-image {
    float: left;
    margin-right: 1rem;
    margin-bottom: 0.5rem;
    max-width: 250px;
  }

  .post-image img {
    max-width: 200px;
    height: auto;
    display: block;
  }

  .file-info {
    font-size: 0.8rem;
    color: #808090;
    margin-top: 0.25rem;
  }

  .post-header {
    margin-bottom: 0.25rem;
  }

  .post-name {
    font-weight: bold;
    color: #88a0d0;
  }

  .post-date {
    color: #707080;
    font-size: 0.875rem;
    margin-left: 0.5rem;
  }

  .post-subject {
    font-weight: 600;
    margin-bottom: 0.5rem;
  }
</style>
{{end}}
